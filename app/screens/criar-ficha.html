<!DOCTYPE html>
<html lang="pt-br">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Personagem - Dungeon's Guild</title>
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx"
            crossorigin="anonymous"
        />
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <link rel="stylesheet" href="http://127.0.0.1:5000/styles/criar-ficha.css" />
        <style>
            .info-principal {
                background: rgba(54, 137, 164, 0.85);
            }
            .info-principal .img-div {
                background-color: #fff;
                background-position: 50% 50%;
                background-size: cover;
            }
            .info-principal > div > div {
                background: rgba(54, 137, 164, 0.85);
            }
            .vida {
                padding: 12px 20px 12px 20px;
                background: rgb(54, 137, 164);
                border-radius: 25px;
            }
            .info {
                background: rgba(54, 137, 164, 0.75);
            }
        </style>
        <link rel="shortcut icon" href="http://127.0.0.1:5000/images/svg/favicon.svg" />
        <script>
            function hexToRGB(hex, alpha) {
                // função que transforma um valor hexadecimal de cor para rgba
                const r = parseInt(hex.slice(1, 3), 16),
                    g = parseInt(hex.slice(3, 5), 16),
                    b = parseInt(hex.slice(5, 7), 16)

                if (alpha) {
                    return `rgba(${r}, ${g}, ${b}, ${alpha})`
                } else {
                    return `rgb(${r}, ${g}, ${b})`
                }
            }

            function inputCounterAndMaxLength(element, counterLength) {
                // altera o contador de caracteres quando o usuário insere no input
                const counter = element.parentElement.querySelector("h5")
                counter.textContent = counterLength
                element.setAttribute("maxLength", counterLength)

                element.addEventListener("input", (e) => {
                    const inputValue = e.target.value
                    counter.textContent = counterLength - inputValue.length
                })
            }

            function changeTestBonuses(element) {
                // altera o bônus das proficiências
                const testValue = element.value
                const text = element.closest("p").lastElementChild
                const salvaguardaId = element.getAttribute("id-salvaguarda")

                function changeValueInPericias(value) {
                    const bonus = Number(document.getElementById("bonus-proficiencia").value)
                    const pericias = document.querySelectorAll(`.pericias [salvaguarda="${salvaguardaId}"]`)
                    
                    for (let i = 0; i < pericias.length; i++) {
                        if (bonus > 0) {
                            if (pericias[i].closest("div").firstElementChild.checked) {
                                return pericias[i].closest("label").lastElementChild.textContent = "+" + (value + bonus)
                            }
                        }
    
                        pericias[i].closest("label").lastElementChild.textContent = "+" + value
                    }

                    document.querySelectorAll(`.testes-resistencia [salvaguarda="${salvaguardaId}"]`).forEach((el) => {
                        if (bonus > 0) {
                            if (document.querySelector(`.testes-resistencia [salvaguarda="${salvaguardaId}"]`)
                                .closest("div").firstElementChild.checked) {
                                return el.closest("label").lastElementChild.textContent = "+" + (value + bonus)
                            }
                        }
                        el.closest("label").lastElementChild.textContent = "+" + value
                    })
                }

                switch (true) {
                    case testValue <= 4:
                        text.textContent = "+2"
                        changeValueInPericias(2)
                        break
                    case testValue <= 8:
                        text.textContent = "+3"
                        changeValueInPericias(3)
                        break
                    case testValue <= 12:
                        text.textContent = "+4"
                        changeValueInPericias(4)
                        break
                    case testValue <= 16:
                        text.textContent = "+5"
                        changeValueInPericias(5)
                        break
                    case testValue > 16:
                        text.textContent = "+6"
                        changeValueInPericias(6)
                        break
                }

                // previne o usuário a inserir um valor menor que 1 ou maior que 20
                if (testValue < 1) return (element.value = 1)
                if (testValue > 20) return (element.value = 20)
            }

            function addBonusToTestes(element, id) {
                // adiciona o bonus ao clicar na caixa de seleção dos testes de resistência
                const div = document.querySelector(`.testes-resistencia [salvaguarda="${id}"]`)
                
                const bonus = Number(document.getElementById("bonus-proficiencia").value)
                const previousBonus = Number(document.querySelector(`[id-salvaguarda="${id}"]`).closest("p").lastElementChild.textContent)

                if (!element.checked) {
                    if (previousBonus == 0) return (div.closest("label").lastElementChild.textContent = "0")

                    return (div.closest("label").lastElementChild.textContent = "+" + previousBonus)
                }

                if (bonus == 0) return

                div.closest("label").lastElementChild.textContent = "+" + (previousBonus + bonus)
            }

            function addBonusToPericias(element, id) {
                // adiciona o bonus ao clicar na caixa de seleção das perícias
                const bonusText = element.closest('.flex').lastElementChild.lastElementChild
                const bonus = Number(document.getElementById("bonus-proficiencia").value)
                const previousBonus = Number(document.querySelector(`[id-salvaguarda="${id}"]`).closest("p").lastElementChild.textContent)
                
                if (!element.checked) {
                    if (previousBonus == 0) return (bonusText.textContent = "0")

                    return (bonusText.textContent = "+" + previousBonus)
                }

                if (bonus == 0) return

                bonusText.textContent = "+" + (previousBonus + bonus)
            }
        </script>
    </head>
    <body>
        <nav>
            <img src="http://127.0.0.1:5000/images/logo.png" alt="" height="70" />
        </nav>
        <main>
            <div class="info-principal">
                <label for="img-personagem">
                    <div class="img-div">
                        <span>Insira uma imagem</span>
                    </div>
                </label>
                <input
                    type="file"
                    name="img-personagem"
                    id="img-personagem"
                    style="display: none"
                />
                <input
                    type="text"
                    class="form-control"
                    placeholder="Nome do seu personagem"
                    name="nome-personagem"
                />
                <h3>Pontos de Vida</h3>
                <div class="vida">
                    <input
                        type="number"
                        placeholder="Vida atual"
                        class="form-control"
                        name="vida-atual"
                    />
                    /
                    <input
                        type="number"
                        class="form-control"
                        placeholder="Vida total"
                        name="vida-total"
                    />
                </div>
                <table>
                    <tr>
                        <th>Classe e nível:</th>
                        <td>
                            <select class="form-select" name="classe" id="classes">
                                <option selected>Selecione uma classe</option>
                            </select>
                            <input
                                type="number"
                                class="form-control"
                                placeholder="LV"
                                name="nivel-classe"
                                min="0"
                                style="width: 45px"
                            />
                        </td>
                    </tr>
                    <tr>
                        <th>Antecedente:</th>
                        <td>
                            <select class="form-select" name="Antecedente" id="antecedentes">
                                <option selected>Selecione um antecedente</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <th>Nome do jogador:</th>
                        <td>Johnny Depp</td>
                    </tr>
                    <tr>
                        <th>Raça:</th>
                        <td>
                            <input
                                type="text"
                                class="form-control"
                                placeholder="Raça"
                                name="raca"
                            />
                        </td>
                    </tr>
                    <tr>
                        <th>Tendência:</th>
                        <td>
                            <select class="form-select" name="tendencia" id="tendencias">
                                <option selected>Selecione uma tendência</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <th>Pontos de experiência:</th>
                        <td>
                            <input
                                type="number"
                                placeholder="XP atual"
                                class="form-control"
                                name="xp-atual"
                            />
                            <span style="margin: 0 4px 0 4px">/</span>
                            <input
                                type="number"
                                placeholder="XP total"
                                class="form-control"
                                name="xp-total"
                            />
                        </td>
                    </tr>
                </table>
                <table>
                    <tr>
                        <th>Idade:</th>
                        <td>
                            <input
                                type="number"
                                placeholder="Idade"
                                class="form-control"
                                name="idade"
                            />
                        </td>
                    </tr>
                    <tr>
                        <th>Altura:</th>
                        <td>
                            <input
                                type="number"
                                placeholder="Altura"
                                class="form-control"
                                name="altura"
                            />
                            <span style="margin-left: 8px">m</span>
                        </td>
                    </tr>
                    <tr>
                        <th>Peso:</th>
                        <td>
                            <input
                                type="number"
                                placeholder="Peso"
                                class="form-control"
                                name="peso"
                            />
                            <span style="margin-left: 8px">kg</span>
                        </td>
                    </tr>
                    <tr>
                        <th>Cabelo:</th>
                        <td>
                            <input
                                type="text"
                                class="form-control"
                                placeholder="Cor do cabelo"
                                name="cabelo"
                            />
                        </td>
                    </tr>
                    <tr>
                        <th>Olhos:</th>
                        <td>
                            <input
                                type="text"
                                class="form-control"
                                placeholder="Cor dos olhos"
                                name="olho"
                            />
                        </td>
                    </tr>
                    <tr>
                        <th>Pele:</th>
                        <td>
                            <input
                                type="text"
                                class="form-control"
                                placeholder="Cor da pele"
                                name="pele"
                            />
                        </td>
                    </tr>
                </table>
                <div class="flex">
                    <h4>Inspiração</h4>
                    <div>
                        <input type="number" class="form-control" name="inspiracao" />
                    </div>
                </div>
                <div class="flex">
                    <h4>Bônus de Proficiência</h4>
                    <div>
                        <input
                            type="number"
                            class="form-control"
                            name="proficiencia"
                            id="bonus-proficiencia"
                        />
                    </div>
                </div>
                <div class="flex">
                    <h4>Sabedoria Passiva (Percepção)</h4>
                    <div>
                        <input type="number" class="form-control" name="percepcao" />
                    </div>
                </div>
                <div class="flex">
                    <h4>Dados de Vida</h4>
                    <div>
                        <input type="number" class="form-control" name="dados-vida" />
                    </div>
                </div>
                <div class="flex">
                    <h4>Classe de Armadura</h4>
                    <div>
                        <input type="number" class="form-control" name="classe-armadura" />
                    </div>
                </div>
                <div class="flex">
                    <h4>Iniciativa</h4>
                    <div>
                        <input type="number" class="form-control" name="iniciativa" />
                    </div>
                </div>
                <div class="flex">
                    <h4>Deslocamento</h4>
                    <div>
                        <input type="number" class="form-control" name="deslocamento" />
                    </div>
                </div>
                <hr />
                <label for="cor-ficha" class="form-label">Cor da ficha</label>
                <input
                    type="color"
                    class="form-control form-control-color"
                    id="cor-ficha"
                    name="cor-ficha"
                    value="#3689A4"
                    title="Escolha sua cor"
                />
            </div>
            <div class="info">
                <div id="carouselControls" class="carousel slide" data-interval="false">
                    <div class="carousel-inner">
                        <div class="carousel-item active">
                            <div class="carrosel-dentro">
                                <!-- informações de dentro do carrosel -->
                                <ul>
                                    <li>Salvaguardas</li>
                                    <li>Testes de Resistência</li>
                                    <li>Perícias</li>
                                </ul>
                            </div>
                        </div>
                        <div class="carousel-item">
                            <div class="carrosel-dentro">
                                <ul>
                                    <li>Idiomas e Proficiências</li>
                                    <li>Equipamentos</li>
                                    <li>Características e Habilidades</li>
                                </ul>
                            </div>
                        </div>
                        <div class="carousel-item">
                            <div class="carrosel-dentro">
                                <ul>
                                    <li>Magias</li>
                                    <li>História</li>
                                    <li>Aliados</li>
                                    <li>Tesouro</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <button
                        class="carousel-control-prev"
                        type="button"
                        data-bs-target="#carouselControls"
                        data-bs-slide="prev"
                    >
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    </button>
                    <button
                        class="carousel-control-next"
                        type="button"
                        data-bs-target="#carouselControls"
                        data-bs-slide="next"
                    >
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    </button>
                </div>
                <div class="detalhes">
                    <div class="salvaguardas">
                        <h2>Salvaguardas</h2>
                        <div>
                            <p>
                                <img src="http://127.0.0.1:5000/images/svg/strength.svg" alt="" />
                                Força:
                                <span>
                                    <input
                                        type="number"
                                        class="form-control"
                                        placeholder="For"
                                        name="forca"
                                        min="1"
                                        max="20"
                                        id-salvaguarda="1"
                                        style="width: 80px; margin: 0"
                                        oninput="changeTestBonuses(this)"
                                    />
                                </span>
                                <b id="bonus">0</b>
                            </p>
                            <p>
                                <img src="http://127.0.0.1:5000/images/svg/dexterity.svg" alt="" />
                                Destreza:
                                <span>
                                    <input
                                        type="number"
                                        class="form-control"
                                        placeholder="Des"
                                        name="destreza"
                                        min="1"
                                        max="20"
                                        id-salvaguarda="2"
                                        style="width: 80px; margin: 0"
                                        oninput="changeTestBonuses(this)"
                                    /> </span
                                ><b id="bonus">0</b>
                            </p>
                            <p>
                                <img
                                    src="http://127.0.0.1:5000/images/svg/constitution.svg"
                                    alt=""
                                />
                                Constituição:
                                <span>
                                    <input
                                        type="number"
                                        class="form-control"
                                        placeholder="Cons"
                                        name="constituicao"
                                        min="1"
                                        max="20"
                                        id-salvaguarda="3"
                                        style="width: 80px; margin: 0"
                                        oninput="changeTestBonuses(this)"
                                    /> </span
                                ><b id="bonus">0</b>
                            </p>
                            <p>
                                <img
                                    src="http://127.0.0.1:5000/images/svg/intelligence.svg"
                                    alt=""
                                />
                                Inteligência:
                                <span>
                                    <input
                                        type="number"
                                        class="form-control"
                                        placeholder="Int"
                                        name="inteligencia"
                                        min="1"
                                        max="20"
                                        id-salvaguarda="4"
                                        style="width: 80px; margin: 0"
                                        oninput="changeTestBonuses(this)"
                                    /> </span
                                ><b id="bonus">0</b>
                            </p>
                            <p>
                                <img src="http://127.0.0.1:5000/images/svg/wisdom.svg" alt="" />
                                Sabedoria:
                                <span>
                                    <input
                                        type="number"
                                        class="form-control"
                                        placeholder="Sab"
                                        name="sabedoria"
                                        min="1"
                                        max="20"
                                        id-salvaguarda="5"
                                        style="width: 80px; margin: 0"
                                        oninput="changeTestBonuses(this)"
                                    /> </span
                                ><b id="bonus">0</b>
                            </p>
                            <p>
                                <img src="http://127.0.0.1:5000/images/svg/charisma.svg" alt="" />
                                Carisma:
                                <span>
                                    <input
                                        type="number"
                                        class="form-control"
                                        placeholder="Car"
                                        name="carisma"
                                        min="1"
                                        max="20"
                                        id-salvaguarda="6"
                                        style="width: 80px; margin: 0"
                                        oninput="changeTestBonuses(this)"
                                    /> </span
                                ><b id="bonus">0</b>
                            </p>
                        </div>
                    </div>
                    <div class="testes-resistencia">
                        <h2>Testes de Resistência</h2>

                        <div class="flex">
                            <input
                                class="form-check-input"
                                type="checkbox"
                                value=""
                                id="forca"
                                oninput="addBonusToTestes(this, 1)"
                            />
                            <label class="form-check-label" for="forca">
                                Força: <span salvaguarda="1">0</span>
                            </label>
                        </div>

                        <div class="flex">
                            <input
                                class="form-check-input"
                                type="checkbox"
                                value=""
                                id="destreza"
                                oninput="addBonusToTestes(this, 2)"
                            />
                            <label class="form-check-label" for="destreza">
                                Destreza: <span salvaguarda="2">0</span>
                            </label>
                        </div>

                        <div class="flex">
                            <input
                                class="form-check-input"
                                type="checkbox"
                                value=""
                                id="constituicao"
                                oninput="addBonusToTestes(this, 3)"
                            />
                            <label class="form-check-label" for="constituicao">
                                Constituição: <span salvaguarda="3">0</span>
                            </label>
                        </div>

                        <div class="flex">
                            <input
                                class="form-check-input"
                                type="checkbox"
                                value=""
                                id="inteligencia"
                                oninput="addBonusToTestes(this, 4)"
                            />
                            <label class="form-check-label" for="inteligencia">
                                Inteligência: <span salvaguarda="4">0</span>
                            </label>
                        </div>

                        <div class="flex">
                            <input
                                class="form-check-input"
                                type="checkbox"
                                value=""
                                id="sabedoria"
                                oninput="addBonusToTestes(this, 5)"
                            />
                            <label class="form-check-label" for="sabedoria">
                                Sabedoria: <span salvaguarda="5">0</span>
                            </label>
                        </div>

                        <div class="flex">
                            <input
                                class="form-check-input"
                                type="checkbox"
                                value=""
                                id="carisma"
                                oninput="addBonusToTestes(this, 6)"
                            />
                            <label class="form-check-label" for="carisma">
                                Carisma: <span salvaguarda="6">0</span>
                            </label>
                        </div>
                    </div>
                    <div class="pericias">
                        <h2>Perícias</h2>
                    </div>
                    <div class="idiomas">
                        <h2>Idiomas e Proficiências</h2>
                        <div class="form-floating">
                            <textarea
                                class="form-control"
                                placeholder="Insira..."
                                id="idiomas-proficiencias"
                                style="height: 320px"
                                name="idiomas-proficiencias"
                            ></textarea>
                            <label for="idiomas-proficiencias"
                                >Insira os idiomas e proficiências</label
                            >
                            <h5 style="text-align: right"></h5>
                        </div>
                    </div>
                    <div class="equips">
                        <h2>Equipamentos</h2>
                        <div class="form-floating">
                            <textarea
                                class="form-control"
                                placeholder="Insira..."
                                id="equipamentos"
                                style="height: 320px"
                                name="equipamentos"
                            ></textarea>
                            <label for="equipamentos">Insira os equipamentos</label>
                            <h5 style="align-self: flex-end"></h5>
                        </div>
                        <div>
                            <table>
                                <tr>
                                    <th>PC:</th>
                                    <td>
                                        <input
                                            type="number"
                                            class="form-control"
                                            placeholder="PC"
                                            name="nivel-classe"
                                            min="0"
                                        />
                                    </td>
                                </tr>
                                <tr>
                                    <th>PP:</th>
                                    <td>
                                        <input
                                            type="number"
                                            class="form-control"
                                            placeholder="PP"
                                            name="nivel-classe"
                                            min="0"
                                        />
                                    </td>
                                </tr>
                                <tr>
                                    <th>PE:</th>
                                    <td>
                                        <input
                                            type="number"
                                            class="form-control"
                                            placeholder="PE"
                                            name="nivel-classe"
                                            min="0"
                                        />
                                    </td>
                                </tr>
                                <tr>
                                    <th>PO:</th>
                                    <td>
                                        <input
                                            type="number"
                                            class="form-control"
                                            placeholder="PO"
                                            name="nivel-classe"
                                            min="0"
                                        />
                                    </td>
                                </tr>
                                <tr>
                                    <th>PL:</th>
                                    <td>
                                        <input
                                            type="number"
                                            class="form-control"
                                            placeholder="PL"
                                            name="nivel-classe"
                                            min="0"
                                        />
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    <div class="caracteristicas">
                        <h2>Características e Habilidades</h2>
                        <div class="form-floating">
                            <textarea
                                class="form-control"
                                placeholder="Insira..."
                                id="caracteristicas"
                                style="height: 320px"
                                name="caracteristicas"
                            ></textarea>
                            <label for="caracteristicas">Insira os idiomas e proficiências</label>
                            <h5 style="text-align: right"></h5>
                        </div>
                    </div>
                    <div class="magias">
                        <div class="flex">
                            <h2>Magias</h2>
                            <a
                                data-bs-toggle="tooltip"
                                data-bs-placement="right"
                                data-bs-html="true"
                                data-bs-title="Para selecionar múltiplas opções, segure <b>Ctrl</b> no Windows ou <b>Command</b> no Mac"
                            >
                                <svg
                                    width="20"
                                    height="20"
                                    viewBox="0 0 24 24"
                                    fill="none"
                                    xmlns="http://www.w3.org/2000/svg"
                                >
                                    <path
                                        d="M4 4.5C4 3.83696 4.26339 3.20107 4.73223 2.73223C5.20107 2.26339 5.83696 2 6.5 2H18C18.3283 2 18.6534 2.06466 18.9567 2.1903C19.26 2.31594 19.5356 2.50009 19.7678 2.73223C19.9999 2.96438 20.1841 3.23998 20.3097 3.54329C20.4353 3.84661 20.5 4.1717 20.5 4.5V18.75C20.5 18.9489 20.421 19.1397 20.2803 19.2803C20.1397 19.421 19.9489 19.5 19.75 19.5H5.5C5.5 19.7652 5.60536 20.0196 5.79289 20.2071C5.98043 20.3946 6.23478 20.5 6.5 20.5H19.75C19.9489 20.5 20.1397 20.579 20.2803 20.7197C20.421 20.8603 20.5 21.0511 20.5 21.25C20.5 21.4489 20.421 21.6397 20.2803 21.7803C20.1397 21.921 19.9489 22 19.75 22H6.5C5.83696 22 5.20107 21.7366 4.73223 21.2678C4.26339 20.7989 4 20.163 4 19.5V4.5ZM12.25 8C12.5152 8 12.7696 7.89464 12.9571 7.70711C13.1446 7.51957 13.25 7.26522 13.25 7C13.25 6.73478 13.1446 6.48043 12.9571 6.29289C12.7696 6.10536 12.5152 6 12.25 6C11.9848 6 11.7304 6.10536 11.5429 6.29289C11.3554 6.48043 11.25 6.73478 11.25 7C11.25 7.26522 11.3554 7.51957 11.5429 7.70711C11.7304 7.89464 11.9848 8 12.25 8ZM11.5 9.75V14.75C11.5 14.9489 11.579 15.1397 11.7197 15.2803C11.8603 15.421 12.0511 15.5 12.25 15.5C12.4489 15.5 12.6397 15.421 12.7803 15.2803C12.921 15.1397 13 14.9489 13 14.75V9.75C13 9.55109 12.921 9.36032 12.7803 9.21967C12.6397 9.07902 12.4489 9 12.25 9C12.0511 9 11.8603 9.07902 11.7197 9.21967C11.579 9.36032 11.5 9.55109 11.5 9.75Z"
                                        fill="white"
                                    />
                                </svg>
                            </a>
                        </div>
                        <select
                            class="form-select"
                            name="magias"
                            multiple
                            aria-label="multiple select example"
                        >
                            <option selected>Selecione uma ou mais magia(s)</option>
                        </select>
                    </div>
                </div>
                <div class="detalhesfora historia">
                    <h2>História</h2>
                    <div class="form-floating">
                        <textarea
                            class="form-control"
                            placeholder="Insira..."
                            id="historia"
                            style="height: 320px"
                            name="historia"
                        ></textarea>
                        <label for="historia">Insira a história do(a) seu(sua) personagem</label>
                        <h5 style="text-align: right"></h5>
                    </div>
                </div>
                <div class="detalhesfora aliados">
                    <h2>Aliados e Organizações</h2>
                    <div class="form-floating">
                        <textarea
                            class="form-control"
                            placeholder="Insira..."
                            id="aliados"
                            style="height: 140px"
                            name="aliados"
                        ></textarea>
                        <label for="aliados"
                            >Insira os aliados e organizações do(a) seu(sua) personagem</label
                        >
                        <h5 style="text-align: right"></h5>
                    </div>
                </div>
                <div class="detalhesfora tesouro">
                    <h2>Tesouro</h2>
                    <div class="form-floating">
                        <textarea
                            class="form-control"
                            placeholder="Insira..."
                            id="tesouro"
                            style="height: 140px"
                            name="tesouro"
                        ></textarea>
                        <label for="tesouro">Insira o tesouro do(a) seu(sua) personagem</label>
                        <h5 style="text-align: right"></h5>
                    </div>
                </div>
            </div>
        </main>

        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"
        ></script>
        <script
            src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
            crossorigin="anonymous"
        ></script>
        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa"
            crossorigin="anonymous"
        ></script>
        <script>
            const inputIdiomas = document.querySelector("#idiomas-proficiencias")
            const inputCaracteristicas = document.querySelector("#caracteristicas")
            const inputHistoria = document.querySelector("#historia")
            const inputAliados = document.querySelector("#aliados")
            const inputTesouro = document.querySelector("#tesouro")
            const inputEquipamentos = document.querySelector("#equipamentos")

            inputCounterAndMaxLength(inputIdiomas, 300)
            inputCounterAndMaxLength(inputCaracteristicas, 500)
            inputCounterAndMaxLength(inputHistoria, 2000)
            inputCounterAndMaxLength(inputAliados, 200)
            inputCounterAndMaxLength(inputTesouro, 200)
            inputCounterAndMaxLength(inputEquipamentos, 500)

            document.querySelector("#bonus-proficiencia").addEventListener("input", (e) => {
                // altera os valores dos testes e perícias ao mudar o bônus de proficiência
                const bonus = Number(e.target.value)
                const bonusesArray = document.querySelectorAll("#bonus")

                // previne que o usuário insira um valor menor que 0
                if (bonus < 0) return (e.target.value = 0)

                for (let i = 0; i < bonusesArray.length; i++) {
                    const previousBonus = Number(bonusesArray[i].textContent)
                    const test = document.querySelectorAll(`.testes-resistencia div`)[i]
                    const pericias = document.querySelectorAll(`.pericias [salvaguarda="${[i + 1]}"]`)
                    
                    pericias.forEach((el) => {
                        let periciasPreviousBonus = Number(bonusesArray[el.getAttribute('salvaguarda') - 1].textContent)
                        
                        if (el.closest('div').firstElementChild.checked) {
                            // altera o valor da perícia com o bônus de proficiência caso esteja marcado
                            if (periciasPreviousBonus == 0 && bonus == 0) {
                                return (el.closest("label").lastElementChild.textContent = "0")
                            }
                            
                            el.closest("label").lastElementChild.textContent = "+" + (periciasPreviousBonus + bonus)
                        }
                    })

                    if (test.firstElementChild.checked) {
                        let idSalvaguarda = test.lastElementChild.lastElementChild.getAttribute('salvaguarda')
                        
                        document.querySelectorAll(`.testes-resistencia [salvaguarda="${idSalvaguarda}"]`).forEach((el) => {
                            // altera o valor do teste de resistência com o bônus de proficiência caso esteja marcado
                            if (previousBonus == 0 && bonus == 0) {
                                return (el.closest("label").lastElementChild.textContent = "0")
                            }
                            
                            el.closest("label").lastElementChild.textContent = "+" + (previousBonus + bonus)
                        })
                    }
                }
            })
        </script>
        <script src="http://127.0.0.1:5000/js/criarficha.js"></script>
    </body>
</html>
